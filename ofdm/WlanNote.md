## introduction

[802.11有多个子标准，如802.11a/b/g/n/ac/ax/be等，每个子标准使用不同的物理层技术，如FHSS、DSSS、OFDM和MIMO等](https://www.bing.com/ck/a?!&&p=ab90d26e2a2ba9c7JmltdHM9MTcxODE1MDQwMCZpZ3VpZD0xNmI1OGM2OS03ZjFjLTY5OWItMWE2OC05ODQ0N2VjZTY4YzYmaW5zaWQ9NTc1NQ&ptn=3&ver=2&hsh=3&fclid=16b58c69-7f1c-699b-1a68-98447ece68c6&psq=802.11%e6%9c%89%e5%93%aa%e4%ba%9b%e5%8d%8f%e8%ae%ae&u=a1aHR0cHM6Ly9zdXBwb3J0Lmh1YXdlaS5jb20vZW50ZXJwcmlzZS96aC9kb2MvRURPQzEwMDAxMTMzMTQvYmQ5NTU3YWQ&ntb=1)[3](https://www.bing.com/ck/a?!&&p=384c20c70d65e8abJmltdHM9MTcxODE1MDQwMCZpZ3VpZD0xNmI1OGM2OS03ZjFjLTY5OWItMWE2OC05ODQ0N2VjZTY4YzYmaW5zaWQ9NTc1Ng&ptn=3&ver=2&hsh=3&fclid=16b58c69-7f1c-699b-1a68-98447ece68c6&psq=802.11%e6%9c%89%e5%93%aa%e4%ba%9b%e5%8d%8f%e8%ae%ae&u=a1aHR0cHM6Ly9zdXBwb3J0Lmh1YXdlaS5jb20vZW50ZXJwcmlzZS96aC9kb2MvRURPQzEwMDAxMTMzMTQvYmQ5NTU3YWQ&ntb=1)[2](https://www.bing.com/ck/a?!&&p=55db694531864049JmltdHM9MTcxODE1MDQwMCZpZ3VpZD0xNmI1OGM2OS03ZjFjLTY5OWItMWE2OC05ODQ0N2VjZTY4YzYmaW5zaWQ9NTc1Nw&ptn=3&ver=2&hsh=3&fclid=16b58c69-7f1c-699b-1a68-98447ece68c6&psq=802.11%e6%9c%89%e5%93%aa%e4%ba%9b%e5%8d%8f%e8%ae%ae&u=a1aHR0cHM6Ly9zdXBwb3J0Lmh1YXdlaS5jb20vZW50ZXJwcmlzZS96aC9kb2MvRURPQzExMDAwMzM5NzYvMzU4MjUyMTQ&ntb=1)。[802.11的演进带来了数据传输速率的提升](https://www.bing.com/ck/a?!&&p=10b74497828f6804JmltdHM9MTcxODE1MDQwMCZpZ3VpZD0xNmI1OGM2OS03ZjFjLTY5OWItMWE2OC05ODQ0N2VjZTY4YzYmaW5zaWQ9NTc1OA&ptn=3&ver=2&hsh=3&fclid=16b58c69-7f1c-699b-1a68-98447ece68c6&psq=802.11%e6%9c%89%e5%93%aa%e4%ba%9b%e5%8d%8f%e8%ae%ae&u=a1aHR0cHM6Ly9zdXBwb3J0Lmh1YXdlaS5jb20vZW50ZXJwcmlzZS96aC9kb2MvRURPQzEwMDAxMTMzMTQvYmQ5NTU3YWQ&ntb=1)[3](https://www.bing.com/ck/a?!&&p=6a44c1decd722827JmltdHM9MTcxODE1MDQwMCZpZ3VpZD0xNmI1OGM2OS03ZjFjLTY5OWItMWE2OC05ODQ0N2VjZTY4YzYmaW5zaWQ9NTc1OQ&ptn=3&ver=2&hsh=3&fclid=16b58c69-7f1c-699b-1a68-98447ece68c6&psq=802.11%e6%9c%89%e5%93%aa%e4%ba%9b%e5%8d%8f%e8%ae%ae&u=a1aHR0cHM6Ly9zdXBwb3J0Lmh1YXdlaS5jb20vZW50ZXJwcmlzZS96aC9kb2MvRURPQzEwMDAxMTMzMTQvYmQ5NTU3YWQ&ntb=1)。

### 80211 a frame format

![1718677545151](image/Wlan/1718677545151.png)

### 80211 n

![1718677561455](image/Wlan/1718677561455.png)

### mix

![1718677578068](image/Wlan/1718677578068.png)

### 80211 ac

![1718677677240](image/Wlan/1718677677240.png)

### 80211 ax

![1718677969748](https://file+.vscode-resource.vscode-cdn.net/d%3A/LocalStorePad/vsDoc/image/Wlan/1718677969748.png)

[Wi-Fi 6 (802.11ax) Design Tips: How to Overcome the Biggest RF Challenges - Qorvo](https://www.qorvo.com/design-hub/blog/designing-for-80211ax-wifi-common-challenges-and-tips-to-overcome-them)

![1718678264224](image/Wlan/1718678264224.png)

[What is 802.11ax (Wi-Fi 6)? | Extreme Networks](https://www.extremenetworks.com/resources/faq/what-is-80211ax)

[Introduction to 802.11ax High-Efficiency Wireless - NI](https://www.ni.com/en/solutions/semiconductor/wireless-connectivity-test/introduction-to-802-11ax-high-efficiency-wireless.html)

![1718678123046](image/Wlan/1718678123046.png)

![1718678114440](image/Wlan/1718678114440.png)![1718678127698](image/Wlan/1718678127698.png)

SU and MU

![1718678092908](image/Wlan/1718678092908.png)

Let us understand 802.11ax frame. Its structure is similar to 802.11n and 802.11ac. It consists of preamble, header and data. The figure-1 depicts both single user and multi user frame structures. Let us understand various WLAN 802.11ax frame fields.

➨It starts with the preamble. The first part of the preamble consists of legacy (non-HE) training fields, and second part consists of HE preamble fields. The legacy portion of the preamble contains L-STF (Legacy i.e. non-HT short training field), L-LTF (legacy long training field) and L-SIG (legacy signal field). This legacy part is decoded by legacy devices. It is included for backward compatibility and coexistence with the legacy wifi devices. RL-SIG field is used as repeated legacy (non-HT) Signal field. The HE preamble can be decoded by 802.11ax devices only.

➨HE preamble contains HE-STF and HE-LTF patterns.

➨The HE header usually consists of HE SIG-A and HE SIG-B fields. HE SIG-A contains information about packet to follow both in downlink and uplink, MCS rate, modulation, BSS color, BW, spatial stream, remaining time in transmit opportunity etc. HE SIG-B is included only for multi-user packets.

➨HE-Data field carries PSDU(s).

➨Max. packet extension modes of duration either 8 µs or 16 µs are used at the end of the 802.11ax frame.

### all used structure

![1718678174182](image/Wlan/1718678174182.png)

## GI

### Guard Interval (GI)

Guard Interval (GI) 是指在两个连续符号传输之间插入的一段空闲时间。它的目的是为了防止来自多径效应的干扰，提高信号的传输可靠性。

在 IEEE 802.11 标准中，定义了以下几种 GI 设定：

* 800 ns GI：这是默认的 GI 设定，也是 802.11 a/b/g 标准中唯一支持的 GI 设定。它提供了良好的抗多径效应能力，但会降低数据传输速率。
* 400 ns GI：这是 802.11n 标准中引入的可选 GI 设定。它可以提高数据传输速率，但会降低抗多径效应能力。
* 800 ns GI：这是 802.11ac 标准中默认的 GI 设定。它与 802.11a/b/g 标准中的 800 ns GI 相同。
* 400 ns GI：这是 802.11ac 标准中可选的 GI 设定。它与 802.11n 标准中的 400 ns GI 相同。
* 1600 ns GI：这是 802.11ax 标准中引入的可选 GI 设定。它提供了最强的抗多径效应能力，但也导致了最低的数据传输速率。
* 3200 ns GI：这是 802.11ax 标准中引入的可选 GI 设定。它提供了次强的抗多径效应能力，但数据传输速率高于 1600 ns GI。
* 

在 IEEE 802.11ax 标准中，GI（Guard Interval，保护间隔）的定义和相关内容主要在以下章节中有所描述：

1. 章节 28: High Efficiency (HE) PHY Specification:

* 这是 802.11ax 标准中定义高效物理层（HE PHY）的部分。在这一章节中，对保护间隔（GI）的长度、使用条件、以及对性能的影响有详细的描述。

2. 章节 29: MAC and PHY Mechanisms for HE Operation:

* 这一章节主要介绍了用于高效操作的 MAC 和 PHY 机制。包括 GI 在内的多种技术细节都有覆盖。

In WLAN systems, particularly those based on the IEEE 802.11 standards, the Guard Interval (GI) plays a crucial role in mitigating inter-symbol interference caused by multipath propagation. The GI is applied in both OFDM symbols and various training fields, including the High-Efficiency Long Training Field (HE-LTF) used in 802.11ax (Wi-Fi 6). Let's explore the differences between the GI in standard OFDM symbols and the HE-LTF.

Key Characteristics of HE-LTF:

Guard Interval Durations:

* Standard GI for HE-LTF: 0.8 μs
* Extended GI for HE-LTF: 1.6 μs

Guard Interval (GI) OFDM symbol:

* Standard GI: 0.8 μs
* Short GI: 0.4 μs

### OFDM Symbol Duration

The OFDM symbol duration is determined by the inverse of the subcarrier spacing and the guard interval.

1. Useful Symbol Time (T_u):

* For 802.11a/g/n/ac, T_u = 1 / Subcarrier Spacing = 1 / 312.5 kHz = 3.2 μs.

2. Guard Interval (GI):

* Standard GI: 0.8 μs
* Short GI: 0.4 μs

3. Total Symbol Duration (T_s):

* With standard GI: T_s = T_u + GI = 3.2 μs + 0.8 μs = 4.0 μs.
* With short GI: T_s = T_u + GI = 3.2 μs + 0.4 μs = 3.6 μs.

一个20 MHz的信道，在802.11n/ac有64个子载波组成，每个OFDM子载波是312.5KHz。其中有52个子载波用于承载数据（data subcarriers），4个子载波用作导频（pilot subcarriers），八个子载波用作保护频带（unused subcarriers）。OFDM子载波可以称为OFDM subcarriers或者OFDM tones。

![1718766370753](image/WlanNote/1718766370753.png)

802.11ax 单个子载波带宽（或者说子载波间隔）从312.5KHz细化到78.125KHz, 从而需要更长的OFDM Symbol时间（12.8μs），这是传统OFDM Symbol的四倍时间（传统为3.2μs）。如上图所示，在子载波带宽变成78.125KHz间隔后，一个20MHz信道一共可以包含256个子载波.

在802.11ax的OFDMA中，一共有三种类型的子载波

* **数据子载波** ：这些子载波用于承载数据，其传输速率是在802.11ac的基础上（即在802.11ac的MCS上），引入了两个新的MCS（Modulation and Coding Schemes），包含1024-QAM这种更高的调制阶数。
* **导频子载波** ：导频子载波用于发送者和接收者之间的同步，其不承载调制数据。
* **未使用的子载波** ：这些子载波主要用作保护子载波（Guard Subcarriers）或空子载波（Null Subcarriers），以抵抗来自相邻信道或相邻子信道的干扰（即抵抗ICI）。

### GI in IEEE 802.11 Standards

IEEE 802.11a/g

* Standard GI: 0.8 μs
* Short GI: Not specified for 802.11a/g (these standards use a fixed GI of 0.8 μs).

IEEE 802.11n (802.11n-2009)/ IEEE 802.11ac (802.11ac-2013) / IEEE 802.11ax (Wi-Fi 6)

* Standard GI: 0.8 μs
* Short GI: 0.4 μs

Similar to 802.11n, 802.11ac also allows the use of a short GI to improve data rates, especially beneficial in environments where multipath interference is less significant.

### Locations in the Standards

The specifications for Guard Intervals can typically be found in the PHY (Physical Layer) section of the respective IEEE 802.11 standards documents. These sections detail the parameters for OFDM modulation, including symbol duration, subcarrier spacing, and GI options.

* 802.11n: Section 20.3 (HT PHY specification)
* 802.11ac: Section 22.3 (VHT PHY specification)
* 802.11ax: Section 27.3 (HE PHY specification)

## HE PPDU

IEEE® 802.11™1 is a packet-based protocol. Each packet, also called a physical layer protocol data unit (PPDU), contains preamble and data fields. The preamble fields contain the **transmission vector format** information. The data field contains the user payload and higher layer headers, such as medium access control (MAC) fields and cyclic redundancy check (CRC). The transmission vector format and the PPDU structure vary between 802.11 versions. The transmission vector (TXVECTOR) format parameter is classified as:

* HE to specify a high-efficiency (HE) physical layer (PHY) implementation.
* HE refers to fields formatted for association with 802.11ax™ data. Reference [[1]](https://jp.mathworks.com/help/wlan/gs/he-ppdu-structure.html#mw_4317b447-1e16-4c98-9f0a-2c58d21a5bb8_sep_mw_biblio_80211ax-2021) defines and describes the HE PHY layer and PPDU.
* For HE, the **TXVECTOR** parameters, as defined in Table 27-1 of [[1]](https://jp.mathworks.com/help/wlan/gs/he-ppdu-structure.html#mw_4317b447-1e16-4c98-9f0a-2c58d21a5bb8_sep_mw_biblio_80211ax-2021), determine the structure of PPDUs transmitted by an HE station (STA).

| 802.11 Version       | Transmission VectorFormat | Modulation Format       | Bandwidth/MHz        |
| -------------------- | ------------------------- | ----------------------- | -------------------- |
| 802.11b™            | non-HT                    | DSSS/CCK                | 11                   |
| 802.11a™            | non-HT                    | OFDM only               | 5, 10, 20            |
| 802.11j™            | non-HT                    | OFDM only               | 10                   |
| 802.11p™            | non-HT                    | OFDM only               | 5, 10                |
| 802.11g™            | non-HT                    | OFDM                    | 20                   |
| non-HT               | DSSS/CCK                  | 11                      |                      |
| 802.11n™ (Wi-Fi 4)  | HT_MF, Non-HT             | OFDM only               | 20, 40               |
| 802.11ac™ (Wi-Fi 5) | VHT, HT_MF, Non-HT        | OFDM only               | 20, 40, 80, 160      |
| 802.11ah™           | S1G                       | OFDM only               | 1, 2, 4, 8, 16       |
| 802.11ad™           | DMG                       | Single Carrier and OFDM | 2640                 |
| 802.11ax™ (Wi-Fi 6) | HE                        | OFDMA                   | 20, 40, 80, 160      |
| 802.11ba™           | WUR                       | MC-OOK                  | 20, 40, 80           |
| 802.11be™ (Wi-Fi 7) | EHT                       | OFDMA                   | 20, 40, 80, 160, 320 |

[https://jp.mathworks.com/help/wlan/gs/wlan-ppdu-structure.html](https://jp.mathworks.com/help/wlan/gs/wlan-ppdu-structure.html)

For HE, there are four transmission modes:

* HE single-user (HE SU),  单用户PPDU,主要是在单用户场景中使用
* HE extended-range SU (HE ER SU) , HE增程(Extended Range)PPDU,主要针对远离AP的单用户场景中，例如室外场景。由于距离较远，信号较弱，因此HE_EXT_SU只能使用低带宽进行低速传输，以保证传输的可靠性。
* HE multi-user (HE MU),  多用户PPDU,可以同时对一个或者多个用户进行一次或者多次传输。
* HE trigger-based (HE TB).HE触发回应帧(HE Trigger-Based PPDU),为单次传输，主要是为了回应触发帧。该帧格式主要在上行OFDMA或者上行MU-MIMO场景中进行传输。这是由于一般来说MU上行链路对设备的发射功率以及传输能力（发送端EVM、MCS支持，空间流支持等）有着严格的要求，然而802.11对终端的能力要求又比较宽泛，各种高低端设备之间差异比较大，为了兼容高端与低端设备，支持HE_Trig格式的设备需要能够通过该报文来表明自己是属于能够满足高要求的高端设备（Class A device）还是无法满足要求的低端设备（Class B device

The [wlanHESUConfig](https://jp.mathworks.com/help/wlan/ref/wlanhesuconfig.html), [wlanHEMUConfig](https://jp.mathworks.com/help/wlan/ref/wlanhemuconfig.html), and [wlanHETBConfig](https://jp.mathworks.com/help/wlan/ref/wlanhetbconfig.html) objects enable you to create PPDUs and waveforms for all of them.

The field structure for HE PPDUs consists of preamble and data portions. The legacy preamble fields (**L-STF, L-LTF, and L-SIG**) are common to all four HE transmission modes, as well as the **EHT, VHT, HT, and non-HT format preambles.** HE preamble fields include additional format-specific signaling fields. Each format defines a data field for the transmission of user payload data.

![1718677203011](image/Wlan/1718677203011.png)

The **RL-SIG, HE-SIG-A, HE-STF, HE-LTF, and PE** fields are present in all HE PPDU formats. The **HE-SIG-B** field is present only in the **HE MU PPDU**. For more information, see Section 27.3.4

| PPDU Field Abbreviation |          Description          | dur (us) |
| :---------------------: | :---------------------------: | :------: |
|          L-STF          |  Non-HT ShortTraining field  |    8    |
|          L-LTF          |  Non-HT Long Training field  |    8    |
|          L-SIG          |      Non-HT Signal field      |    4    |
|         RL-SIG         | Repeated Non-HT Signal field |    4    |
|        HE-SIG-A        |       HE Signal A field       |  8 / 4  |
|        HE-SIG-B        |       HE Signal B field       |  4 / 8  |
|         HE-STF         |    HE Short Training field    |  4 / 8  |
|         HE-LTF         |    HE Long Training field    |          |
|         HE-Data         | Data field carrying the PSDUs |          |
|           PE           |    Packet Extension field    |          |

S--short； L--Long

TF-- train field； SIG--Signal Field

[wlanHESUConfig](https://jp.mathworks.com/help/wlan/ref/wlanhesuconfig.html)

```matlab
cfgHE = wlanHESUConfig;
cfgHE.ChannelBandwidth = 'CBW40'
```

```matlab
cfgHE = 
  wlanHESUConfig with properties:

        ChannelBandwidth: 'CBW40'
     NumTransmitAntennas: 1
     NumSpaceTimeStreams: 1
          SpatialMapping: 'Direct'
     PreHESpatialMapping: 0
                    STBC: 0
                     MCS: 0
                     DCM: 0
           ChannelCoding: 'LDPC'
              APEPLength: 100
           GuardInterval: 3.2000
               HELTFType: 4
        UplinkIndication: 0
                BSSColor: 0
            SpatialReuse: 0
            TXOPDuration: 127
             HighDoppler: 0
    NominalPacketPadding: 0
    PostFECPaddingSource: 'mt19937ar with seed'
      PostFECPaddingSeed: 73
```

* **GuardInterval** — Guard interval (cyclic prefix) duration3.2 (default) | 1.6 | 0.8

Guard interval (cyclic prefix) duration for the data field within a packet, in microseconds, specified as 3.2, 1.6, or 0.8.

The possible value of this property depends on the HELTFType property. For 1 × HE-LTF or 2 × HE-LTF, the value cannot be 3.2. For 4 × HE-LTF, the value cannot be 1.6.

* **HELTFType** — HE-LTF compression mode of HE PPDU4 (default) | 2 | 1

HE-LTF compression mode of HE PPDU, specified as 4, 2, or 1. This property indicates the type of HE-LTF, where a value of 4, 2, or 1 corresponds to four times, two times, or one times HE-LTF duration compression mode, respectively. Table 27-1 of [[2]](https://jp.mathworks.com/help/wlan/ref/wlanhesuconfig.html#mw_12ce61d2-4b46-4827-9281-e65b2413e9ba_sep_mw_biblio_80211ax-2021) enumerates the HE-LTF type as:

* 1 × HE-LTF — Duration of 3.2 μs. The guard interval duration must be 0.8 μs or 1.6 μs.
* 2 × HE-LTF — Duration of 6.4 μs. The guard interval duration must be 0.8 μs or 1.6 μs.
* 4 × HE-LTF — Duration of 12.8 μs. The guard interval duration must be 0.8 μs or 3.2 μs.

For more information on the HE-LTF, see section 27.3.11.10 of [[2]](https://jp.mathworks.com/help/wlan/ref/wlanhesuconfig.html#mw_12ce61d2-4b46-4827-9281-e65b2413e9ba_sep_mw_biblio_80211ax-2021).

Aggregated MPDU (A-MPDU) pre-end-of-frame (pre-EOF) padding (APEP) length, in bytes, specified as an integer in the interval [0, 6451631]. Setting this property to 0 specifies transmission of an HE NDP.

#### Data modulation

![1718677895560](image/Wlan/1718677895560.png)

#### L-SIG Field

The L-SIG field includes the following components:

1. RATE Field:

   * Indicates the data rate used for transmitting the rest of the preamble and the payload.
2. LENGTH Field:

   * Specifies the length of the PPDU in microseconds, indicating how long the transmission will last.
3. Parity Bit:

   * Used for error detection within the L-SIG field.
4. Tail Bits:

   Used to reset the convolutional encoder for the transmission

#### L-STF和L-LTF序列

##### 简介

L-STF（短训练序列）和L-LTF（长训练序列）是IEEE 802.11ac协议中用于进行同步的序列。在此协议中，同步分为两个步骤——粗同步（也称数据包检测）和细同步（符号同步）。其中，粗同步用于判断数据包的到来，细同步用于将数据包的位置精确到bit位。L-STF和L-LTF序列分别用于粗同步和细同步。

![1718678394704](image/Wlan/1718678394704.png)

如图所示为802.11ac中数据包的结构，L-STF由10个重复的短码元组成，L-LTF由一段符号间隔和2个重复码元构成，如图所示

![1718678425984](image/Wlan/1718678425984.png)

##### L-STF生成

![1718678529937](image/Wlan/1718678529937.png)

![1718678529937](image/Wlan/1718678529937.png)![1718678562161](image/Wlan/1718678562161.png)

**L-STF 的定义和作用**

L-STF 是数据包前导码的一部分，用于帮助接收器在一系列重要任务中执行同步和信道估计，包括：

1. 时间同步：确定数据包的开始时间。
2. 频率同步：纠正频率偏移。
3. 信道估计：估计信道特性以便于数据解码。

**L-STF 的结构**

L-STF 通常由 10 个短训练符号（Short Training Symbols）组成，每个符号由 16 个采样点构成，总共 160 个采样点。这些符号以重复的方式传输，具有较高的自相关性，使接收器能够容易地检测到信号的到来并进行同步和频率校正。

L-STF 的特点

* 高峰值自相关性：有利于时间和频率同步。
* 重复结构：有助于频率偏移估计和校正。
* 能量分布均匀：在整个信道中分布均匀，有助于信道估计。

**L-STF 的信号生成**

L-STF 信号是通过对特定的训练序列进行 IFFT（逆快速傅里叶变换）生成的。该训练序列在频域中具有特定的符号和相位分布，以确保在时域中的良好自相关性。

具体的 L-STF 序列

在 IEEE 802.11a 标准中，L-STF 的频域符号可以表示为：

* 26 个子载波，子载波的幅度为 ±1，符号间的相位关系设定为特定的模式。

这些特定的序列在传输时经过 IFFT 转换成时域信号，以便于传输和接收处理。

**总结**

L-STF 是 WLAN 中用于信道估计和同步的关键信号字段，结构简单且功能强大，保证了无线通信链路的可靠性和有效性。在实际应用中，L-STF 的有效使用是实现高效无线通信的基础。

##### L-STF生成

L-STF (Legacy Short Training Field) 的信号生成涉及将特定的频域序列通过 IFFT (逆快速傅里叶变换) 转换为时域信号。以下是生成 L-STF 信号的详细步骤：

###### 频域序列定义

在 IEEE 802.11a 标准中，L-STF 的频域序列由 52 个子载波组成，其中包含 48 个数据子载波和 4 个导频子载波。频域序列的定义如下：、

* 子载波索引范围：-26 到 +26（不包括 0，即中心直流子载波被跳过）
* 子载波幅度：±1
* 序列相位：特定模式
* 频域序列符号可以表示为：
* 

```
S[k]={0,0,1,1,−1,−1,1,1,−1,1,−1,1,1,1,−1,−1,−1,1,−1,1,−1,0,−1,1,−1,−1,0,−1,1,−1,1,1,−1,1,1,1,1,1,−1,1,−1,0,−1,1,−1,1,1,1,1,−1,−1,1,−1,1,−1,0,0}
```

```matlab
%   LSTF = lstfSequence returns the sequence used for 20 MHz L-STF as
%   per equation 20-8 in IEEE Std 802.11-2012 pg. 1695.
%   L-STF (IEEE Std:802.11-2012, pg 1695)
lstf = 1/sqrt(2)*[0; 0; 1+1i; 0; ...
0; 0;-1-1i; 0; ...
0; 0; 1+1i; 0; ...
0; 0;-1-1i; 0; ...
0; 0;-1-1i; 0; ...
0; 0; 1+1i; 0; ...
0; 0;    0; 0; ...
0; 0;-1-1i; 0; ...
0; 0;-1-1i; 0; ...
0; 0; 1+1i; 0; ...
0; 0; 1+1i; 0; ...
0; 0; 1+1i; 0; ...
0; 0; 1+1i; 0; 0];
```

###### IFFT 转换

将上述频域序列进行 IFFT 转换，以得到时域序列。典型的 IFFT 大小为 64 点（因子 N=64），频域序列需要适当地插入零填充，使得序列总长度达到 64 点。

x[n]=IFFT(S[k])

其中  x[n] 是生成的时域信号。

以下是具体生成 L-STF 信号的步骤：

1. 构建频域序列：构建符合上述定义的频域序列，并插入零填充以使其长度为 64。
2. 进行 IFFT：对频域序列进行 64 点 IFFT 转换，得到时域序列。
3. 重复时域序列：将时域序列重复 10 次，得到完整的 L-STF 信号。

Matlab 代码

```matlab
cfgVHT = wlanVHTConfig('ChannelBandwidth','CBW40');
y = wlanLSTF(cfgVHT);
size(y)
plot(abs(y))
xlabel('Samples')
ylabel('Amplitude')
```

**ABS PLOT**

![1718679055949](image/Wlan/1718679055949.png)

##### L-STF 和 L-LTF的同步

实现同步有多种方法——自相关算法，互相关算法，最大似然机制等等。这里介绍利用自相关算法实现粗同步和利用互相关算法实现细同步。

**粗同步**

粗同步是对接收到的序列进行自相关。由于包头内含有多个重复的S序列，可以想象，即使是失真后，序列之间的相似度仍然比一般序列要高，根据这一特点，我们取两个长16的窗口，延序列滑动，对窗口内的数据进行自相关，如果得到的结果能在一段时间内维持在一个临界值以上（该临界值通过经验得出），则可以认为找到了包头，即确认了数据包的到来。但此时得到的位置可能是在序列中的任意位置，我们接下来要通过细同步来确定OFDM符号的起始点。

    ![1718678478179](image/Wlan/1718678478179.png)

**细同步**

细同步的思想跟粗同步类似，只不过细同步是将接收到的序列与本地L-LTF序列进行互相关，找到互相关的结果最大的位置，显然，只有当窗口起点在L-LTF序列的起点时，得到的互相关的结果最大。由于L-LTF序列长度已知，就可以得到OFDM符号开始的位置。

#### 802.11AX TRIGGER FRAME

Here is the structure of the common info field:

![1718679120887](image/Wlan/1718679120887.png)

Here are some of the interesting sub-fields:

* **UL Length:** it indicates the length of the expected response frame (filter = wlan.trigger.he.ul_length)
* **UL BW (Up Link Bandwidth):** it indicates the bandwidth of the transmission (filter = wlan.trigger.he.ul_bw)

  * 0 means 20MHz
  * 1 means 40MHz
  * 2 means 80MHz
  * 3 means 80+80MHz or 160MHz
* **GI and LTF Type:** it indicates which guard interval and long training field will be used for the transmission (` filter = wlan.trigger.he.gi_and_ltf_type` )

  * 0 means 1x HE-LFT + 1.6us GI will be used
  * 1 means 2x HE-LFT + 1.6us GI will be used
  * 3 means 4x HE-LFT + 3.2us GI will be used
* **AP TX Power:** when the AP sends the trigger frame, it will provide the Tx Power used to transmit the frame (`filter = wlan.trigger.he.ap_tx_power`）

![1718679230415](image/Wlan/1718679230415.png)

#### USER INFO FIELD

The User Info field provides details on each client devices participating in the same upcoming OFDMA transmission.

![1718679911087](image/Wlan/1718679911087.png)

![1718679917225](image/Wlan/1718679917225.png)

Here are some of the interesting sub-fields:

* Association ID: indicates the association ID of the addressed STA (`filter =wlan.trigger.he.user_info.aid`)
* RU Allocation: indicates the size and location of the ressource unit allocated for the addressed STA (`filter = wlan.trigger.he.ru_allocation`)
* UL MCS: indicates which MCS is expected the STA to use (`filter = wlan.trigger.he.mcs`)
* SS Allocation: indicates the number of spatial streams to be used by the addressed STA. You will have to minus 1 to the number. (`filter = wlan.trigger.he.ru_number_of_spatial_stream`)
* Target RSSI: indicates the the expected RSSI of the PPDU to be sent on the RU (`filter = wlan.trigger.he.target_rssi`)

Here is an example of a common field:

![1718680624054](image/Wlan/1718680624054.png)

In this example, we can see that 2x STA will be sharing the 20MHz channel in 2x 106-tones Ressource Units.

Both client devices are expected to be using MCS 11, 1 spatial streams. And their PPDUs is expected to be received with a RSSI of -30dBm.

[The 802.11ax Trigger Frame – SemFio Networks](https://semfionetworks.com/blog/the-80211ax-trigger-frame/)

#### LDPC Tone Mapper

![1718680741425](image/Wlan/1718680741425.png)

#### HE-LTF and GI duration Type

![1718680763356](image/Wlan/1718680763356.png)![1718680771013](image/Wlan/1718680771013.png)

The HE-LTF is designed for robust channel estimation, allowing the receiver to accurately estimate the channel characteristics, which is crucial for effective demodulation and decoding of the subsequent data symbols.

#### 26-Tone RU

![1718680805296](image/Wlan/1718680805296.png)

#### Pilot

##### Subcarriers

![1718680826613](image/Wlan/1718680826613.png)

##### pilot position

![1718680838442](image/Wlan/1718680838442.png)

##### pilot sequence

![1718680935123](image/Wlan/1718680935123.png)

```cpp
const int HELTF20M_x1_RuSC40MHz 1x HE-LTF  
const int HELTF40M_x1_RuSC
```

##### DC and guard subcarriers

![1718681011807](image/Wlan/1718681011807.png)

##### NULL Subcarrier

![1718681027133](image/Wlan/1718681027133.png)

![1718681038492](image/Wlan/1718681038492.png)

#### PSDU Length calculation

![1718681093980](image/Wlan/1718681093980.png)

```matlab
function params = heRateDependentParameters(ruSize,mcs,NSS,DCM)
function params = heRateDependentParameters(ruSize,mcs,NSS,DCM)
```
